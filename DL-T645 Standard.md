## DL/T645 Standard

### 简介

DL/T645是中华人民共和国电力行业标准，也称为《多功能电能表通信协议》。该标准规定了多功能电能表（智能电表）与上位机（如集中管理系统）之间的通信协议，包括物理层、数据链路层、应用层等内容，旨在保证智能电表与上位机之间的可靠通信，满足电力行业的自动化、信息化和智能化要求。DL/T645标准已经历数次修订，目前最新版本为DL/T645-2018。

### 与modbus协议的联系

DL/T645协议和Modbus协议都是用于智能电表与上位机之间的通信协议，但是它们是不同的协议。

Modbus协议是一种广泛使用的通信协议，用于连接工业自动化设备，包括传感器、控制器和其他设备。它是一种简单、开放、广泛支持的通信协议，支持多种物理层和数据链路层协议。

而DL/T645协议是专门为电力行业设计的协议，用于智能电表和上位机之间的通信，它规定了特定的物理层、数据链路层和应用层协议。DL/T645协议中定义了多种数据帧格式，包括查询帧、应答帧和异常帧等，可以满足电力行业中电能计量、电费计算、远程抄表等应用需求。

虽然这两种协议不同，但是Modbus协议也可以用于智能电表和上位机之间的通信，只需要对Modbus协议进行适当的扩展和定制。例如，可以定义Modbus寄存器映射到电表的各种参数和数据，然后使用Modbus读取和写入这些寄存器以实现数据交换。

### 与modbus协议的差别

下面是一些具体的例子，用于说明DL/T645协议和Modbus协议的差别：

1. 数据帧格式不同

DL/T645协议中定义了多种数据帧格式，包括查询帧、应答帧和异常帧等。例如，查询帧的格式为：起始符、地址码、控制码、数据长度、数据标识、校验码、结束符。

Modbus协议中定义了两种数据帧格式，分别是RTU（远程终端单元）格式和ASCII格式。例如，RTU格式的数据帧包含地址码、功能码、数据、CRC校验等字段。

1. 支持的功能码不同

DL/T645协议定义了多种功能码，用于读取电能计量数据、设置电表参数、控制电表继电器等操作。

Modbus协议也定义了多种功能码，包括读取线圈状态、读取离散输入状态、读取保持寄存器等操作。Modbus还支持扩展功能码，用于更复杂的数据交换操作。

1. 应用领域不同

DL/T645协议主要应用于电力行业中的智能电表和上位机之间的通信，用于电能计量、电费计算、远程抄表等应用。

Modbus协议广泛应用于工业自动化领域，用于连接传感器、控制器、执行器等设备，实现数据采集、控制和监控等功能。

1. 发展历史不同

DL/T645协议是中国电力行业标准，由中国电力行业标准化技术委员会制定和管理，与中国电力行业的实际需求密切相关。

Modbus协议则是由美国Modicon公司在上世纪70年代提出的，是工业自动化领域最早使用的通信协议之一，后来成为了工业自动化领域的国际标准。

### 协议格式

DL/T 645标准定义了多种数据帧格式，包括查询帧、应答帧和异常帧等。下面是DL/T 645标准中最常见的查询帧格式：

1. 起始符：68H（1个字节）
2. 地址码：表示智能电表的地址，由6个字节组成（BCD码格式），包括厂商代码、设备类型、通信地址等信息。
3. 控制码：表示查询或设置电表参数的功能码，由1个字节组成。例如，读取电表的电压、电流、功率因数等参数时，控制码为11H；设置电表时钟时，控制码为08H。
4. 数据长度：表示后续数据的长度，由1个字节组成。
5. 数据标识：表示查询或设置的数据项，由2个字节组成。例如，读取电表电压时，数据标识为0001H；读取电表电流时，数据标识为0002H。
6. 数据域：表示查询或设置的数据，长度根据数据标识和数据类型而定，可以是整型、浮点型、BCD码等格式。
7. 校验码：表示数据帧的校验和，由1个字节组成，通常使用CRC16或者BCC校验算法。
8. 结束符：16H（1个字节）

下面是一个例子，演示如何使用DL/T 645标准读取电表的电压数据：

1. 查询帧：68 99 99 99 99 99 99 11 02 01 00 00 01 00 00 23 16
2. 应答帧：68 99 99 99 99 99 99 91 02 01 04 01 00 00 3C 7B 16

其中，起始符为68H，地址码为999999999999H，控制码为11H，数据长度为02H，数据标识为0001H，表示查询电压数据。应答帧中的数据域为3C7BH，表示电压数据为15.31V（BCD码格式）。

需要注意的是，DL/T 645标准还规定了很多其他的数据帧格式，包括应答帧、异常帧、广播帧等，每种帧格式的具体内容和用途都不同。在实际应用中，需要根据具体的需求选择合适的数据帧格式和数据项。