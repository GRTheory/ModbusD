## The Format of Modbus Protocol over TCP/IP

在TCP/IP通信中，Modbus协议的数据帧格式与RTU通信有所不同。TCP/IP通信使用基于TCP/IP协议的Socket通信，数据格式以二进制形式传输。Modbus协议在TCP/IP通信中，将数据帧封装在TCP/IP数据包中，通信的格式如下：

- ### 事务标识符（Transaction Identifier）

事务标识符是指TCP/IP通信中用于标识不同事务的唯一标识符，占据两个字节。发送方发送的请求报文和接收方返回的响应报文中的事务标识符必须相同。

- ### 协议标识符（Protocol Identifier）

协议标识符是指Modbus协议在TCP/IP通信中所使用的协议标识符，占据两个字节。其值固定为0x0000。

- ### 数据长度（Length）

数据长度是指Modbus数据帧中除事务标识符和协议标识符外的字节数，占据两个字节。其值等于数据帧中数据码的字节数加上功能码和地址码各占一个字节的长度。

- ### 单元标识符（Unit Identifier）

单元标识符是指Modbus设备的单元标识符，占据一个字节。其值在TCP/IP通信中无意义，可以设置为任意值。

- ### 功能码（Function Code）

功能码是指Modbus通信中要执行的具体功能，占据一个字节。与RTU通信一样，不同的功能码对应不同的数据格式和处理方式。

- ### 数据码（Data）

数据码是指Modbus通信中传输的数据，其长度和内容由具体的功能码决定。数据码可以包括一个或多个字节，其内容可以是数据、状态信息、控制指令等。

- ### 校验码（Checksum）

校验码用于验证数据的完整性，通常采用CRC校验方式。对于单个数据帧，校验码由所有数据码的CRC校验值计算得出。

总的来说，在TCP/IP通信中，Modbus协议的数据帧格式与RTU通信有所不同，增加了事务标识符、协议标识符和数据长度等字段，同时将数据帧封装在TCP/IP数据包中进行传输，具有更高的数据传输效率和安全性。