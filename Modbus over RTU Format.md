## Modbus协议在RTU通信中的格式

- ### 起始位（Start Bit)

 总线上的通信始终以一个起始位开始，该位为逻辑0。

- ### 地址码（Address）

地址码是指Modbus通信中的设备地址，通常占据一个字节。它可以是0-247之间的任意整数。其中0代表广播地址，用于向总线上所有设备发送信息。1~~247代表具体的设备地址。

- ### 功能码（Function Code）

功能码是指Modbus通信中要执行的具体功能，占据一个字节。它包括读取和写入数据、读取和写入多个数据、设定单个数据等功能。不同的功能码对应不同的数据格式和处理方式。

- ### 数据码（Data）

数据码是指Modbus通信中传输的数据，其长度和内容由具体的功能码决定。数据码可以包括一个或多个字节，其内容可以是数据、状态信息、控制指令等。

- ### 校验码（Checksum）

校验码用于验证数据的完整性，通常采用CRC校验方式。对于单个数据帧，校验码由所有数据码的CRC校验值计算得出。

- ### 停止位（Stop Bit）

通信结束时，总线上发送一个停止位，改位为逻辑1.

- ### 帧间隔（Inter-Frame Gap）

帧间隔是指两个Modbus数据帧之间的时间间隔，通常为3.5字符时间。在实际通信中，帧间隔时间可以根据具体情况进行调整。

总的来说，Modbus协议的数据帧格式比较简单，其主要由地址码、功能码、数据码和校验码四部分组成，每个部分的长度和具体内容都由功能码来决定。这种简单的格式使得Modbus协议具有较高的灵活性和可靠性，也使得它成为工业自动化领域的主流通信协议之一。



- [ ] ### 例子（example）

  假设主设备（地址为1）需要从从设备（地址为2）读取保持寄存器（功能码03），读取地址为40001的保持寄存器，读取两个字（4个字节）的数据。

  1. 主设备发送指令

     | 起始位 | 地址位 | 功能码 | 数据1 | 数据2 | 数据3 | 数据4 | CRC校验位 | 停止位 |
     | :----: | :----: | :----: | :---: | :---: | ----- | :---: | :-------: | :----: |
     |   0    |   1    |   03   |  00   |  00   | 00    |  02   |   0439    |   1    |

  2. 从设备返回数据

     | 起始位 | 地址位 | 功能码 | 数据1 | 数据2 | 数据3 | 数据4 | CRC校验位 | 停止位 |
     | :----: | :----: | :----: | :---: | :---: | :---: | :---: | :-------: | :----: |
     |   0    |   2    |   03   |  04   |  23   |  01   |  7b   |   5c7f    |   1    |

